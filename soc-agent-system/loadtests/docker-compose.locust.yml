# =============================================================================
# SOC Agent System — Locust Load Testing (Distributed)
# =============================================================================
# Runs a Locust master + worker(s) for distributed load generation against
# the SOC backend running on the host machine (port 8000).
#
# Usage:
#   cd soc-agent-system/loadtests
#   docker compose -f docker-compose.locust.yml up --scale worker=2
#
# Locust UI: http://localhost:8089
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # Locust Master — Web UI + test coordinator
  # ---------------------------------------------------------------------------
  master:
    image: locustio/locust:latest
    container_name: soc-locust-master
    ports:
      - "8089:8089"
    volumes:
      - .:/mnt/locust
    command: -f /mnt/locust/locustfile.py --master --host=http://host.docker.internal:8000
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - default
      - observability

  # ---------------------------------------------------------------------------
  # Locust Worker — Executes load generation (scale with --scale worker=N)
  # ---------------------------------------------------------------------------
  worker:
    image: locustio/locust:latest
    volumes:
      - .:/mnt/locust
    command: -f /mnt/locust/locustfile.py --worker --master-host=master
    depends_on:
      - master
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - default
      - observability

# =============================================================================
# Networks
# =============================================================================
networks:
  default:
    driver: bridge
  observability:
    external: true
    name: observability

